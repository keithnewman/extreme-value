test_that("Dataset methods work correctly on Dataset class", {
  dtarget <- expect_silent(
    c(15.1249777991325, 562.559191947099, 187.054758182469,
      166.797567508183, 372.414012585939, 52.9671161708165,
      327.446575033221, 34.7432562848553, 32.2776194661856,
      240.330300283361, 902.901863789029, 82.3148078118378,
      167.169231106527, 14.6917511010543, 379.382771884507,
      486.192238496101, 194.784252893853, 20.426926901564,
      0.723452074453235, 201.312096080485, 316.600534355941,
      649.840459661716, 53.1098395586014, 350.660245299445,
      411.993681897825, 156.863480922766, 38.9949292581082,
      133.529976126738, 218.199397426772, 31.9395031547174,
      186.366850538143, 5.03512034155473, 207.488336619031,
      106.164490338415, 400.835157816714, 296.755670093674,
      343.193733588535, 249.001049103409, 12.78518862091,
      221.475008631799)
  )
  d <- expect_silent(Dataset$new(dtarget, "kJ"))
  expect_equal(d$getData(), dtarget)
  expect_length(d$getData(), 40)
  expect_equal(d$length(), 40)
  
  # Test the units and test overwriting of units
  expect_match(d$units, "kJ")
  expect_invisible(d$setUnits("seconds"), "seconds")
  expect_match(d$units, "seconds")
  
  expect_equal(d$sortData(),
               c(0.723452074453235, 5.03512034155473, 12.78518862091,
                 14.6917511010543, 15.1249777991325, 20.426926901564,
                 31.9395031547174, 32.2776194661856, 34.7432562848553,
                 38.9949292581082, 52.9671161708165, 53.1098395586014,
                 82.3148078118378, 106.164490338415, 133.529976126738,
                 156.863480922766, 166.797567508183, 167.169231106527,
                 186.366850538143, 187.054758182469, 194.784252893853,
                 201.312096080485, 207.488336619031, 218.199397426772,
                 221.475008631799, 240.330300283361, 249.001049103409,
                 296.755670093674, 316.600534355941, 327.446575033221,
                 343.193733588535, 350.660245299445, 372.414012585939,
                 379.382771884507, 400.835157816714, 411.993681897825,
                 486.192238496101, 562.559191947099, 649.840459661716,
                 902.901863789029))
  expect_is(d$summaryPlotly(), "plotly")
  
  # Dataset can be given new data
  expect_invisible(d$setData(c(4.5, 12.3, 14.5, 51.2, -1)),
                   c(4.5, 12.3, 14.5, 51.2, -1))
  expect_equal(d$length(), 5)
  expect_equal(d$sortData(), c(-1, 4.5, 12.3, 14.5, 51.2))
  expect_length(d$getData(), 5)
})

test_that("Dataset can be made from (contaminated) string", {
  d <- expect_warning(
    DataFromString$new("100123,99913,100240,100448;f00,100162;100296,
                        100015,     ;;;;;;100122,99930,99997,100710,
                        ba&R, 100136,",
                       units = "\u2126")
  )
  expect_equal(as.numeric(d$getData()),
               c(100123, 99913, 100240, 100448, 100162, 100296,
                 100015, 100122, 99930, 99997, 100710, 100136))
  expect_match(d$units, "\u2126")
  expect_equal(d$length(), 12)
  expect_equal(d$sortData(),
               c(99913, 99930, 99997, 100015, 100122, 100123,
                 100136, 100162, 100240, 100296, 100448, 100710))
  expect_invisible(d$setData("12 3442 53; 13 5"),
                   c(12, 3442, 53, 13, 5))
})

